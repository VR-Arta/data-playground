Updated queries and indexes for better performance
